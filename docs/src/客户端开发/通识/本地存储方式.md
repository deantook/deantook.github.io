# 📖 客户端开发通识：本地存储方式

## 1️⃣ 本地存储的概念

* **本地存储**：客户端在设备上存储数据，以便应用重启后仍能访问或离线使用。
* **作用**：

    1. 保存用户偏好设置（主题、语言）
    2. 缓存数据（接口响应、图片）
    3. 离线访问（断网场景）
    4. 提升性能（减少重复网络请求）

## 2️⃣ 存储方式分类

| 类型                   | 说明                | 优点        | 缺点         | 对应 Flutter 插件             |
| -------------------- | ----------------- | --------- | ---------- | ------------------------- |
| **KV 存储（Key-Value）** | 键值对形式存储小型数据       | 简单、轻量     | 不适合复杂结构    | `shared_preferences`      |
| **关系型数据库**           | 类 SQL 数据库，表结构存储数据 | 支持复杂查询、事务 | 较重，初次学习成本高 | `sqflite`                 |
| **NoSQL / 本地对象存储**   | 面向对象或文档存储         | 灵活、高性能    | 查询复杂度高     | `hive`、`objectbox`        |
| **文件存储**             | 保存文件（图片、日志、缓存）    | 灵活，可存大文件  | 不便于查询结构化数据 | `path_provider` + Dart IO |
| **加密存储**             | 存储敏感信息（Token、密码）  | 安全        | 需管理加密逻辑    | `flutter_secure_storage`  |

## 3️⃣ 各平台本地存储对应

| 平台      | KV                  | 数据库               | 文件                           | 备注           |
| ------- | ------------------- | ----------------- | ---------------------------- | ------------ |
| Android | SharedPreferences   | SQLite / Room     | Internal / External Storage  | 权限管理注意外部存储   |
| iOS     | UserDefaults        | CoreData / SQLite | 沙箱 Documents / tmp / Library | 沙箱机制限制访问     |
| Flutter | shared\_preferences | sqflite / drift   | path\_provider + 文件 API      | 插件统一封装原生 API |

## 4️⃣ 使用场景示例

1. **KV 存储**

    * 保存开关状态、主题模式、语言偏好
    * Flutter 示例：

      ```dart
      final prefs = await SharedPreferences.getInstance();
      await prefs.setBool('darkMode', true);
      bool isDark = prefs.getBool('darkMode') ?? false;
      ```

2. **关系型数据库**

    * 保存购物车列表、用户笔记
    * 支持事务、复杂查询、数据关联

3. **NoSQL / 对象存储**

    * 高速缓存用户数据，支持对象直接序列化存储
    * Hive 示例：

      ```dart
      var box = await Hive.openBox('myBox');
      box.put('username', 'Alice');
      var name = box.get('username');
      ```

4. **文件存储**

    * 存储图片、下载文件、日志文件
    * 通过 `path_provider` 获取沙箱路径，使用 Dart IO 读写

5. **加密存储**

    * 保存敏感信息，如 Token、密码
    * 使用平台安全存储或加密库，保证安全性

## 5️⃣ 服务端工程师类比

| 客户端存储                                 | 服务端类比                   |
| ------------------------------------- | ----------------------- |
| KV / UserDefaults / SharedPreferences | Redis / 配置文件            |
| SQLite / CoreData / sqflite           | 数据库（MySQL / PostgreSQL） |
| 文件存储                                  | 日志文件、缓存文件               |
| 加密存储                                  | 密码哈希、密钥存储               |

💡 **核心启示**：

* 本地存储是客户端状态管理的持久化手段
* 根据数据结构、访问频率、敏感性选择存储方案
* Flutter 提供统一插件封装，大幅降低跨平台差异的复杂度

