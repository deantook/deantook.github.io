# 系统监控与性能（System Monitoring & Performance）

## 一、学习目标

完成本课后，学习者应能够：
1. 理解系统监控与性能管理的重要性。
2. 掌握关键性能指标（KPI）和监控工具的使用。
3. 能够设计和实施监控方案，及时发现和解决性能问题。
4. 学会基于监控数据进行容量规划和优化决策。

---

## 二、核心概念

系统监控与性能管理是确保系统稳定运行、满足业务需求的关键工程实践。

### 核心概念

1. **关键性能指标（KPI, Key Performance Indicators）**
    - **响应时间（Response Time）**：用户请求到系统响应的时间
    - **吞吐量（Throughput）**：单位时间内系统处理的请求数量
    - **可用性（Availability）**：系统正常运行的时间比例
    - **错误率（Error Rate）**：系统错误请求占总请求比例
    - **资源利用率（CPU, Memory, Disk, Network）**：监控系统负载

2. **监控类型**
    - **基础设施监控（Infrastructure Monitoring）**：服务器、网络、存储
    - **应用性能监控（APM, Application Performance Monitoring）**：应用内部性能指标
    - **日志监控（Log Monitoring）**：错误、警告、访问日志分析
    - **用户体验监控（UX Monitoring）**：前端性能和用户操作响应

3. **性能瓶颈识别**
    - CPU 或内存过高
    - 数据库响应慢
    - 网络延迟
    - 应用代码效率低

4. **容量规划（Capacity Planning）**
    - 基于历史数据预测系统扩展需求
    - 提前准备资源以应对流量增长

---

## 三、实操方法

1. **确定监控目标**
    - 明确业务关键流程（如支付、登录、数据处理）
    - 定义需要监控的 KPI

2. **部署监控工具**
    - 常用工具：Prometheus + Grafana、New Relic、Datadog、ELK Stack
    - 设置仪表盘展示关键指标

3. **设置告警与阈值**
    - 当关键指标超过阈值触发告警
    - 配置告警通知（邮件、Slack、Opsgenie）

4. **性能分析与优化**
    - 分析监控数据，找出性能瓶颈
    - 优化数据库查询、缓存策略、代码性能、系统架构

5. **定期容量评估**
    - 根据增长趋势评估资源需求
    - 制定扩展计划（水平扩展/垂直扩展）

---

## 四、案例分析

**案例：电商平台双十一流量监控**

- **监控目标**：订单提交、支付流程、库存服务响应
- **KPI**：支付响应时间 < 2s，订单吞吐量 ≥ 5000 TPS
- **监控工具**：Prometheus + Grafana，ELK 日志分析
- **告警策略**：
    - CPU > 80% 持续 5 分钟报警
    - 支付响应时间 > 2s 持续 3 分钟报警
- **优化措施**：
    - 对支付服务使用 Redis 缓存减轻数据库压力
    - 调整微服务实例数，实现自动扩容
    - 优化查询语句，提高响应速度

---

## 五、常见问题与误区

1. **监控指标过多**：导致信息噪音大，难以发现关键问题
2. **告警阈值设置不合理**：过于敏感或不够敏感，错过关键事件
3. **忽略业务视角**：只看技术指标，无法保证用户体验
4. **监控数据未分析**：积累数据但未用于决策和优化

---

## 六、练习与作业

1. 确定你项目或系统的 5 个关键性能指标（KPI）。
2. 使用 Prometheus 或其他监控工具创建仪表盘。
3. 设置告警阈值并模拟告警触发场景。
4. 分析历史性能数据，提出至少两条优化建议。

---

## 七、扩展阅读

- 《Site Reliability Engineering (SRE)》— 系统监控与性能管理章节
- 《The Art of Monitoring》— James Turnbull
- 在线工具：Prometheus + Grafana、Datadog、New Relic、ELK Stack